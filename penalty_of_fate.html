<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Penalty Of Fate - Career Mode Tools</title>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@500;600;700;800&display=swap" rel="stylesheet">
  <script>
    // Authentication checking script
    document.addEventListener('DOMContentLoaded', function() {
      // Try to read from cookies first
      function getCookie(name) {
        const value = `; ${document.cookie}`;
        const parts = value.split(`; ${name}=`);
        if (parts.length === 2) return parts.pop().split(';').shift();
        return null;
      }
      
      // Check if user is authenticated via cookie or localStorage
      const cookieAuth = getCookie('patreonAuthenticated');
      const localStorageAuth = localStorage.getItem('patreonAuthenticated');
      
      console.log('Cookie auth:', cookieAuth);
      console.log('LocalStorage auth:', localStorageAuth);
      
      // If not authenticated through either method, try API verification
      if (cookieAuth !== 'true' && localStorageAuth !== 'true') {
        verifyWithApi();
      }
    });
    
    // Fallback to API verification if needed
    async function verifyWithApi() {
      try {
        const response = await fetch('/api/auth/verify');
        const data = await response.json();
        
        if (!response.ok || !data.authenticated) {
          // Redirect unauthenticated users to login
          window.location.href = '/';
        } else {
          // If API verification succeeds but cookies/localStorage failed,
          // store the authentication in localStorage for future checks
          localStorage.setItem('patreonAuthenticated', 'true');
        }
      } catch (error) {
        console.error('Auth verification failed:', error);
        // Redirect on error to be safe
        window.location.href = '/';
      }
    }
  </script>
  <style>
    :root {
      --main-bg-color: #0e1129;
      --secondary-bg: #1a203c;
      --accent-color: #4eff8a;
      --accent-glow: rgba(78, 255, 138, 0.4);
      --text-color: #ffffff;
      --text-secondary: #9fadc2;
      --danger-color: #ff424d;
      --danger-glow: rgba(255, 66, 77, 0.4);
      --slot-bg: #0c1024;
      --slot-border: #29335c;
      --slot-highlight: #4eff8a;
      --card-bg: #1e254a;
      --card-border: #29335c;
      --button-bg: linear-gradient(135deg, #4eff8a, #00a5ff);
      --danger-button-bg: linear-gradient(135deg, #ff424d, #ff9f00);
      --button-shadow: 0 10px 20px rgba(78, 255, 138, 0.3);
      --dark-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Montserrat', sans-serif;
      background-color: var(--main-bg-color);
      background-image: 
        radial-gradient(circle at 20% 30%, rgba(41, 51, 92, 0.4) 0%, transparent 400px),
        radial-gradient(circle at 80% 70%, rgba(78, 255, 138, 0.1) 0%, transparent 400px);
      color: var(--text-color);
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 20px;
      overflow-x: hidden;
    }

    .container {
      width: 100%;
      max-width: 1000px;
      position: relative;
    }

    .header {
      text-align: center;
      margin-bottom: 40px;
    }

    .title {
      font-size: 44px;
      font-weight: 800;
      background: linear-gradient(to right, #4eff8a, #00a5ff);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      text-transform: uppercase;
      letter-spacing: 2px;
      margin-bottom: 15px;
      position: relative;
      display: inline-block;
      text-shadow: 0 0 20px rgba(78, 255, 138, 0.3);
    }

    .description {
      color: var(--text-secondary);
      font-size: 18px;
      max-width: 800px;
      margin: 0 auto 30px;
      line-height: 1.6;
    }

    .game-container {
      background-color: var(--secondary-bg);
      border-radius: 20px;
      box-shadow: var(--dark-shadow);
      padding: 30px;
      position: relative;
      overflow: hidden;
      border: 1px solid var(--card-border);
      margin-bottom: 30px;
    }

    .game-container::before {
      content: "";
      position: absolute;
      top: -50%;
      left: -50%;
      right: -50%;
      bottom: -50%;
      background: linear-gradient(45deg, 
        rgba(78, 255, 138, 0) 45%, 
        rgba(78, 255, 138, 0.1) 50%, 
        rgba(78, 255, 138, 0) 55%);
      z-index: 1;
      animation: shine 5s infinite;
      pointer-events: none;
    }

    @keyframes shine {
      0% { transform: translateX(-100%) translateY(-100%) rotate(45deg); }
      100% { transform: translateX(100%) translateY(100%) rotate(45deg); }
    }

    .pitch {
      width: 100%;
      background-color: #162542;
      background-image: 
        linear-gradient(rgba(78, 255, 138, 0.1) 1px, transparent 1px),
        linear-gradient(90deg, rgba(78, 255, 138, 0.1) 1px, transparent 1px);
      background-size: 20px 20px;
      border-radius: 15px;
      padding: 40px 20px;
      position: relative;
      margin-bottom: 30px;
      border: 1px solid var(--card-border);
      box-shadow: inset 0 0 30px rgba(0, 0, 0, 0.5);
      z-index: 2;
    }

    .goals-container {
      display: flex;
      justify-content: space-between;
      flex-wrap: wrap;
      gap: 20px;
      margin-top: 50px;
    }

    .goal {
      flex: 1;
      min-width: 120px;
      height: 140px;
      background-color: var(--slot-bg);
      border: 2px solid var(--slot-border);
      border-radius: 15px;
      position: relative;
      cursor: pointer;
      overflow: hidden;
      transition: all 0.3s ease;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
    }

    .goal:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 25px rgba(78, 255, 138, 0.3);
      border-color: var(--accent-color);
    }

    .goal::before {
      content: "";
      position: absolute;
      width: 100%;
      height: 100%;
      background-image: 
        linear-gradient(to bottom, transparent 80%, rgba(0, 0, 0, 0.3)),
        radial-gradient(circle at center, rgba(255, 255, 255, 0.1) 0%, transparent 70%);
      z-index: 2;
    }

    .goal-number {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 36px;
      font-weight: 800;
      color: var(--text-secondary);
      z-index: 3;
    }

    .ball {
      position: absolute;
      width: 30px;
      height: 30px;
      border-radius: 50%;
      background: linear-gradient(135deg, #ffffff 0%, #d0d0d0 100%);
      box-shadow: 0 5px 10px rgba(0, 0, 0, 0.3);
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      z-index: 4;
      transition: all 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      opacity: 1;
    }

    .ball::after {
      content: "";
      position: absolute;
      width: 100%;
      height: 100%;
      border-radius: 50%;
      background-image: 
        radial-gradient(circle at 30% 30%, rgba(255, 255, 255, 0.8) 0%, transparent 60%);
      z-index: 5;
    }

    .result {
      position: absolute;
      top: 120%;
      left: 50%;
      transform: translateX(-50%);
      width: 100%;
      text-align: center;
      font-size: 22px;
      font-weight: 700;
      opacity: 0;
      transition: all 0.7s ease;
      z-index: 3;
      text-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
    }

    .result.safe {
      color: var(--accent-color);
      text-shadow: 0 0 10px var(--accent-glow);
    }

    .result.danger {
      color: var(--danger-color);
      text-shadow: 0 0 10px var(--danger-glow);
    }

    .result.visible {
      opacity: 1;
      top: 70%;
    }

    .controls {
      display: flex;
      justify-content: center;
      margin-top: 30px;
      z-index: 5;
      position: relative;
    }

    .reset-button {
      background: var(--button-bg);
      color: var(--main-bg-color);
      font-size: 18px;
      font-weight: 700;
      text-transform: uppercase;
      padding: 16px 40px;
      border: none;
      border-radius: 50px;
      cursor: pointer;
      box-shadow: var(--button-shadow);
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
      display: inline-block;
    }

    .reset-button:hover {
      transform: translateY(-5px);
      box-shadow: 0 15px 30px rgba(78, 255, 138, 0.4);
    }

    .reset-button:active {
      transform: translateY(0);
      box-shadow: 0 5px 15px rgba(78, 255, 138, 0.3);
    }

    .reset-button::before {
      content: "";
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: linear-gradient(
        to right,
        rgba(255, 255, 255, 0) 0%,
        rgba(255, 255, 255, 0.3) 50%,
        rgba(255, 255, 255, 0) 100%
      );
      transform: rotate(45deg);
      animation: shimmer 3s infinite;
      pointer-events: none;
      z-index: 1;
    }

    @keyframes shimmer {
      0% { top: -150%; left: -150%; }
      100% { top: 150%; left: 150%; }
    }

    .reset-button span {
      position: relative;
      z-index: 2;
    }

    .instruction {
      text-align: center;
      color: var(--accent-color);
      font-size: 22px;
      font-weight: 600;
      margin-bottom: 30px;
      text-shadow: 0 0 10px rgba(78, 255, 138, 0.3);
    }

    @media (max-width: 768px) {
      .title {
        font-size: 32px;
      }
      
      .goals-container {
        flex-direction: column;
        align-items: center;
      }
      
      .goal {
        width: 80%;
        max-width: 300px;
      }
      
      .instruction {
        font-size: 18px;
      }
      
      .reset-button {
        font-size: 16px;
        padding: 12px 30px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1 class="title">PENALTY OF FATE</h1>
      <p class="description">Choose one of the five goals to take your penalty shot. Will you be safe or will you have to sacrifice your best player? Three goals lead to safety, but two will force you to make a tough decision.</p>
    </div>
    
    <div class="game-container">
      <p class="instruction">Choose a goal to shoot at...</p>
      
      <div class="pitch">
        <div class="goals-container">
          <div class="goal" data-goal="1">
            <div class="goal-number">1</div>
            <div class="result" id="result-1"></div>
          </div>
          <div class="goal" data-goal="2">
            <div class="goal-number">2</div>
            <div class="result" id="result-2"></div>
          </div>
          <div class="goal" data-goal="3">
            <div class="goal-number">3</div>
            <div class="result" id="result-3"></div>
          </div>
          <div class="goal" data-goal="4">
            <div class="goal-number">4</div>
            <div class="result" id="result-4"></div>
          </div>
          <div class="goal" data-goal="5">
            <div class="goal-number">5</div>
            <div class="result" id="result-5"></div>
          </div>
        </div>
        
        <div class="ball" id="ball"></div>
      </div>
      
      <div class="controls">
        <button class="reset-button" id="resetButton"><span>RESET</span></button>
      </div>
    </div>
  </div>

  <script>
    // Game variables
    let gameActive = true;
    let dangerGoals = [];
    
    // Possible outcomes for "danger" results
    const dangerOutcomes = [
      "GET RID OF YOUR TOP DEFENDER",
      "GET RID OF YOUR TOP MIDFIELDER",
      "GET RID OF YOUR TOP ATTACKER"
    ];
    
    // Initialize the game
    function initGame() {
      // Reset variables
      gameActive = true;
      dangerGoals = [];
      
      // Hide all results
      document.querySelectorAll('.result').forEach(result => {
        result.classList.remove('visible', 'safe', 'danger');
        result.textContent = '';
      });
      
      // Reset ball position
      const ball = document.getElementById('ball');
      ball.style.transform = 'translateX(-50%)';
      ball.style.bottom = '20px';
      ball.style.left = '50%';
      ball.style.opacity = '1';
      
      // Determine which goals are dangerous (2 random goals)
      while (dangerGoals.length < 2) {
        const randomGoal = Math.floor(Math.random() * 5) + 1;
        if (!dangerGoals.includes(randomGoal)) {
          dangerGoals.push(randomGoal);
        }
      }
      
      // Assign outcomes to all goals
      document.querySelectorAll('.goal').forEach(goal => {
        const goalNumber = parseInt(goal.getAttribute('data-goal'));
        const resultElement = document.getElementById(`result-${goalNumber}`);
        
        if (dangerGoals.includes(goalNumber)) {
          // Pick a random danger outcome
          const randomIndex = Math.floor(Math.random() * dangerOutcomes.length);
          resultElement.textContent = dangerOutcomes[randomIndex];
          resultElement.classList.add('danger');
        } else {
          resultElement.textContent = "SAFE";
          resultElement.classList.add('safe');
        }
      });
      
      // Update instruction
      document.querySelector('.instruction').textContent = "Choose a goal to shoot at...";
    }
    
    // Handle goal click
    function handleGoalClick(event) {
      if (!gameActive) return;
      
      // Find the clicked goal
      const goal = event.currentTarget;
      const goalNumber = parseInt(goal.getAttribute('data-goal'));
      const result = document.getElementById(`result-${goalNumber}`);
      
      // Calculate ball animation
      const ball = document.getElementById('ball');
      const goalRect = goal.getBoundingClientRect();
      const pitchRect = document.querySelector('.pitch').getBoundingClientRect();
      
      // Animate ball moving to goal
      const goalCenterX = goalRect.left + (goalRect.width / 2) - pitchRect.left;
      const goalCenterY = goalRect.top + (goalRect.height / 2) - pitchRect.top;
      
      ball.style.left = `${goalCenterX}px`;
      ball.style.bottom = `${pitchRect.height - goalCenterY}px`;
      
      // Disable game interaction
      gameActive = false;
      
      // Show result after ball animation
      setTimeout(() => {
        ball.style.opacity = '0';
        result.classList.add('visible');
        
        // Update instruction based on result
        const instruction = document.querySelector('.instruction');
        if (dangerGoals.includes(goalNumber)) {
          instruction.textContent = "Bad luck! You must sacrifice a player.";
          instruction.style.color = 'var(--danger-color)';
        } else {
          instruction.textContent = "You're safe! Your squad remains intact.";
          instruction.style.color = 'var(--accent-color)';
        }
      }, 600);
    }
    
    // Initialize event listeners
    document.addEventListener('DOMContentLoaded', function() {
      // Set up click handlers for goals
      document.querySelectorAll('.goal').forEach(goal => {
        goal.addEventListener('click', handleGoalClick);
      });
      
      // Set up reset button
      document.getElementById('resetButton').addEventListener('click', function() {
        initGame();
      });
      
      // Initialize game on load
      initGame();
    });
  </script>
</body>
</html>
